<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>A Recursive Path Tracer</title>

    <!-- Bootstrap Core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Theme CSS -->
    <link href="css/clean-blog.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <a class="navbar-brand" href="index.html">Main Page</a>
            </div>

        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header class="intro-header" style="background-image: url('img/sun_rise.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>A Recursive Path Tracer</h1>
                        <h3>
                            Implemented a Monte Carlo method based path tracer that supports lambertian surface, fresnel metals, dielectric Fresnel material, absorption using Beer Lambert Law, environment mapping, Ashikhmin BRDF and attempted Cook Torrence BRDF.
                        </h3>
                        <span class="meta">Posted by Alex Ouyang on June 15, 2017</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Post Content -->
    <article>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

                    <h2 class="section-heading">Recursive Path Tracing</h2>
                    <p>
                        One way to implement ray tracing is to use Monte Carlo method based path tracing. Fundamentally, path tracing integrates over all the illuminance arriving to a single point on a surface recursively, and you repeat this process for each ray shoots out form the camera. The illuminance is calculated using a BRDF (Bidirectional Reflectance Distribution Function) which is a function that defines how light is reflected at a surface.
                    <p>
                    <p>
                        My initial version of the path tracer supports diffuse lighting without shadows from both point and directional light sources on primitive object such as boxes. I also have a simple camera model with adjustable camera matrix, field of view, and output image resolution. It looks something like this:
                        <img class="img-responsive blog-img" src="img/p2/basic.jpg" alt="">
                    <p>

                    <h2 class="section-heading">Bounding Volume Hierarchy (BVH)</h2>
                    <p>
                        For a path tracer, we can roughly estimate its rendering time as being proportional to the number of ray-triangle intersection tests required. My initial version of the path tracer is very primitive, for each ray I loop through all triangles in the scene to check for intersection, but this method is very expansive and inefficient, so I decided to do something to speed up my path tracer. The obvious way is to add multi-threading, which I did using OpenMP. The rendering process is dynamically scheduled, the image is divided into batches where each batch is a row of pixels and are fed into the threads. Multi-threading increased the rendering speed significantly.
                    </p>
                    <p>
                        Another common way to increase rendering speed is to take advantage of spatial data structure and that's why I decided to implement a type of BVH called Axis-aligned Box Tree. The idea is to wrap all triangles in the scene in bounding volumes that form the leaf nodes of the tree. These nodes are then grouped as small sets and enclosed within larger bounding volumes. These, in turn, are also grouped and enclosed within other larger bounding volumes in a recursive fashion, eventually resulting in a tree structure with a single bounding volume at the top of the tree. This reduces the ray-triangle intersection check from linear to logarithmic. The tree construction process happens before we begin actual rendering, it can be a time consuming process that itself often runs at O(N log N) performance for N triangles in the scene. Note that O(N log N) is slower than linear, but we hope that the entire tree creation is still faster than the render itself. Ultimately however, as N grows, this can be the limiting factor to scene complexity.
                        <img class="img-responsive blog-img" src="img/p2/bvh.png" alt="">
                    </p>
                    </p>
                        On top of that I also implemented a mesh loader for PLY objects, it parses a mesh file and construct the BVH tree.
                    <p>


                    <h2 class="section-heading">AntiAliasing</h2>
                    <p>
                    </p>


                    <h2 class="section-heading">Lambertian reflectance and Cosine-Weighted Hemisphere sample distribution</h2>
                    <p>
                    </p>


                    <h2 class="section-heading">Fresnel metals</h2>
                    <p>
                    </p>

                    <h2 class="section-heading">Environment Mapping</h2>
                    <p>
                        I started out implementing an spherical environment map because it is an easy way to make rendered images look more realistic. To implement the environment map, for each ray that doesn't intersect with anything in the scene I simply UV map the ray direction onto the sky box texture to sample a color. To make testing easier, I implemented sphere ray intersection and used spheres instead of other complicated models.
                        <br>
                        <br>
                        I got some really nice environment panorama online for free from http://texturify.com/. Below are the results
                        <img class="img-responsive blog-img" src="img/p2/env_2.jpg" alt="">
                        <img class="img-responsive blog-img" src="img/p2/env_1.jpg" alt="">
                    <p>

                    <h2 class="section-heading">Fresnel Dielectric</h2>
                    <p>
                        Since I already have a working path tracer with ideal fresnel surface implemented, I decided to implementing Fresnel Dielectrics next. The ideal fresnel surface assumes total internal reflection, which means the proportion of the light reflected is 100%, so only the reflection path is chosen. For the Fresnel Dielectrics, I calculate the proportion of the light reflected and transmitted using the Fresnel Equations, then chose either the reflection or the refraction path based on importance sampling given fr (Fresnel reflection coefficient) and ft (Fresnel refraction coefficient).
                    </p>
                    <p>
                        The following image shows a Fresnel Dielectric spheres with refraction index of 1.333(water), 1.309(ice), 1.8(glass), 2.42(diamond), and 10 in order from left to right. All spheres below have absorption coefficient of 0, roughtnes of 0.2 and sampling size of 2x2 rays per pixel.
                        <img class="img-responsive blog-img" src="img/p2/dielectric_2x2.jpg" alt="">
                        <br> 
                        This is the same image with 20x20 sampling size, it's a lot less noisy as we can see.
                        <img class="img-responsive blog-img" src="img/p2/dielectric_20x20.jpg" alt="">
                        <br>
                        Yet another image showcasing Fresnel Dielectric material with refraction index of 10.
                        <img class="img-responsive blog-img" src="img/p2/dielectric_2.jpg" alt="">
                    </p>
                    

                    <h2 class="section-heading">Absorption</h2>
                    <p>
                        I then used the Beer-Lambert law to achieve color absorption for Fresnel Dielectrics. The Beer-Lambert law relates the absorption of light to the properties of the material through which the light is traveling. The following image has different absorption coefficient and absorption colors. Notice that the middle sphere has a ring shaped noise to it, sadly I don't know what's causing it.
                        <img class="img-responsive blog-img" src="img/p2/dielectric__color_20x20.jpg" alt="">
                    <p>


                    <h2 class="section-heading">Cook Torrence BRDF - Totally Fail</h2>
                    <p>
                        I also wanted to try implementing Cook Torrence BRDF to simulate rough metals. However, after reading the original paper I couldn't figure out the monte carlo integration part so I got some weird results.
                        <br>
                        <br> 
                        The copper-ish looking dragon on the far right is rendered using Cook Torrence BRDF with roughness of 0.8. But instead of looking like rough copper it looks rusted.
                        <img class="img-responsive blog-img" src="img/p2/ct_2.jpg" alt="">
                        <br> 
                        The silver-ish looking dragon in the middle is also rendered using Cook Torrence.
                        <img class="img-responsive blog-img" src="img/p2/ct_1.jpg" alt="">
                    <p>

                   

                    <h2 class="section-heading">Final Results</h2>
                    <p>
                        These are the final images I rendered. The sphere on the far left is transparent glass Fresnel Dielectrics and the dragon on the right has absorption color of red. The black holder is also Fresnel Dielectrics with absoprtion color of RGB(0.2, 0.2, 0.2) and really high absorption coefficient of 20. The gold dragon in the middle is Ashikhmin BRDF. Those images below each have a sampling rate of 10x10 per pixel and it took about an hour to render each image on my 13'' macbook pro. The result looks pretty satisfying. 
                        <img class="img-responsive blog-img" src="img/p2/final_2.jpg" alt="">
                        <br>
                        Yet another image.
                        <img class="img-responsive blog-img" src="img/p2/final_1.jpg" alt="">
                    </p>


                    <h2 class="section-heading">References</h2>
                    <p>
                        <ul>
                            <li>
                                <a href="https://cseweb.ucsd.edu/classes/sp17/cse168-a/">CSE168: Rendering Algorithms Lecture Slides - Steve Rotenberg</a>
                            </li>
                            <li>
                                <a href="http://inst.cs.berkeley.edu/~cs294-13/fa09/lectures/cookpaper.pdf">A Reflectance Model for Computer Graphics - Robert L. Cook & Kenneth E. Torrance</a>
                            </li>
                            <li>
                                <a href="http://www.codinglabs.net/article_physically_based_rendering_cook_torrance.aspx">Physically Based Rendering Cook Torrence - CodingLabs.net</a>
                            </li>
                            <li>
                                <a href="http://texturify.com/">Environment Maps</a>
                            </li>
                        </ul>
                    </p>

                </div>
            </div>
        </div>
    </article>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <!--<ul class="list-inline text-center">
                        <li>
                            <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>-->
                    <p class="copyright text-muted">Copyright &copy; 2017</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="vendor/jquery/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>
    <script src="js/contact_me.js"></script>

    <!-- Theme JavaScript -->
    <script src="js/clean-blog.min.js"></script>

</body>

</html>
